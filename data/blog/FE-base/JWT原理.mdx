---
title: 'JWT 校验原理'
date: '2024-04-08'
tags: ['FE']
draft: false
---

JSON Web Token（JWT）是一种开放标准（RFC 7519），它定义了一种简洁、自包含的方式，用于在网络应用环境中安全地传递信息。JWT 常用于用户身份验证和信息交换。为了便于理解，我们可以从以下几个方面来逐步讲解：

1. JWT 是什么？

JWT 是一种由三部分组成的字符串，用于传递信息。它通常用于认证用户身份和进行信息交换。JWT 的格式如下：

header.payload.signature

	•	Header（头部）：JWT 的头部通常包含两部分信息：类型（即 JWT）和签名算法（如 HMAC SHA256 或 RSA）。
	•	Payload（有效载荷）：有效载荷包含了需要传递的数据，通常是声明（Claims）。这些声明可以是关于实体（通常是用户）的数据，或者是其他任何信息。需要注意的是，JWT 的有效载荷部分不是加密的，因此其中的信息是明文的。
	•	Signature（签名）：签名是用来验证消息在传输过程中没有被篡改，并且是由合法的发送方创建的。签名是由头部和有效载荷组成的内容以及一个私密密钥共同计算出来的。

2. JWT 的结构

JWT 有三个部分，分别是：
	•	Header：
通常为一个 JSON 对象，描述 JWT 的类型（通常是 “JWT”）和所使用的签名算法（如 HMAC SHA256）。
示例：

{
  "alg": "HS256",
  "typ": "JWT"
}


	•	Payload：
包含了声明（Claims），这些声明是我们想传递的信息。声明有三种类型：
	•	Registered Claims（注册声明）：JWT 规定的一些标准字段，如 iss（发行者）、exp（过期时间）、sub（主题）、aud（受众）等。
	•	Public Claims（公共声明）：可以自定义的声明，但为了避免冲突，应该遵循某些规则。
	•	Private Claims（私有声明）：这些是双方自定义的声明，常用来传递用户信息。
示例：

{
  "sub": "1234567890",
  "name": "John Doe",
  "iat": 1516239022
}


	•	Signature：
签名部分是用来确保消息的完整性。签名是由以下方式生成的：

HMACSHA256(
  base64UrlEncode(header) + "." + base64UrlEncode(payload),
  secret)

	•	base64UrlEncode(header) 和 base64UrlEncode(payload) 是对 header 和 payload 进行 Base64 编码（URL-safe）。
	•	HMACSHA256 是一种基于 SHA-256 算法的哈希签名方法。
	•	secret 是一个私密的密钥（在服务器端保持机密），它用于生成签名。
这部分的作用是确保 JWT 的有效载荷没有被篡改，同时也验证了 JWT 是否是由合法的发送方生成的。

3. JWT 的工作流程

JWT 通常用于用户认证中。其基本流程可以描述为：
	1.	用户登录：
用户提交自己的用户名和密码到服务器，服务器验证用户信息。如果验证成功，服务器就会生成一个 JWT 并返回给客户端。这个 JWT 中包含了用户的相关信息，比如用户 ID、角色等。
	2.	客户端存储 JWT：
客户端接收到 JWT 后，通常会将其存储在浏览器的 localStorage 或 sessionStorage 中，或者将其存储在 HTTP Cookie 中。
	3.	客户端发送请求：
每次客户端向服务器发送请求时，都会在 HTTP 请求头中带上这个 JWT（通常是放在 Authorization 字段中，格式为 Bearer <token>）。
	4.	服务器验证 JWT：
服务器接收到带有 JWT 的请求后，会验证 JWT 的有效性，包括：
	•	JWT 是否过期（通过 exp 字段）。
	•	JWT 的签名是否正确，以确保消息没有被篡改。
	•	如果验证通过，服务器会根据 JWT 中的信息处理请求。

4. JWT 的优点
	•	无状态：JWT 是自包含的，服务器不需要存储会话信息。所有的认证信息都保存在 JWT 内部，这样可以减少服务器的负担，适合分布式应用。
	•	灵活性：JWT 可以携带任何形式的声明，不仅限于用户身份。可以用于传递任意的用户信息。
	•	跨域认证：JWT 支持跨域认证，因为它可以通过 HTTP Headers 或者 Cookies 进行传递，适用于单页应用（SPA）等场景。
	•	便捷性：JWT 是 JSON 格式，易于理解和使用，可以方便地在不同的系统间传输。

5. JWT 的安全性问题

虽然 JWT 非常方便，但也存在一些安全性问题需要注意：
	•	不加密：JWT 默认不加密，尤其是 payload 部分。因此，如果你将敏感信息存储在 JWT 中，恶意用户可以轻松解码并查看这些信息。为了保护敏感信息，可以使用 JWE（JSON Web Encryption）来加密 JWT，或者尽量避免将敏感信息存储在 JWT 中。
	•	密钥管理：JWT 的签名依赖于服务器的密钥，因此必须确保私密密钥的安全。如果密钥泄露，攻击者可以伪造 JWT。
	•	过期时间设置：为了减少 JWT 被滥用的风险，应该合理设置 JWT 的过期时间（exp），并且在过期后强制用户重新登录。

6. 总结

JWT 是一种简单且高效的方式来处理身份验证和信息交换，它通过自包含的方式将用户信息和签名封装在一个令牌中，不依赖于服务端存储会话信息。JWT 适用于现代 Web 应用，尤其是分布式系统中，可以有效地减少服务器负担。然而，使用 JWT 时需要注意安全性问题，特别是签名密钥的管理和敏感数据的保护。
